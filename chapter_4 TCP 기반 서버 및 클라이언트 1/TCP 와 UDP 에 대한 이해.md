## TCP 와 UDP 에 대한 이해
인터넷 프로토콜 기반 소켓일 경우 데이터 전송방법에 따라서 TCP 소켓과 UDP 소켓으로 나뉘고 특히 TCP 소켓의 경우 연결을 지향하기 때문에 '스트림 기반 소켓'이라고도 이야기한다.
TCP 는 Transmission Control Protocol 의 약자로써 '데이터 전송과정의 컨트롤'이라는 뜻을 담고 있다. 때문에 TCP 솤세의 정확한 이해를 위해서는 컨트롤의 방법과 범위에 대해 살펴본느 것이 도움이 된다.

## TCP/IP 프로토콜 스택
TCP 를 이야기하기 하기 앞서 TCP 가 속해있는 'TCP/IP 프로토콜 스택'을 먼저 설명하고자 한다. 다음 그림은 TCP/IP 프로토콜 스택 (Stack , 계층)을 보여준다.

![alt text](/image/image3.png)

위 그림을 통해서 TCP/IP 스택이 총 네 개의 계층으로 나뉨을 알 수 있는데, 이는 데이터 송수신의 과정을 네 개의 영역으로 계층화했다는 의미로 받아들일 수 있다. 즉 '인터넷 기반의 효율적인 데이터 전송' 이 라는 커다란 하나의 문제를 하나의 덩치 큰 프로토콜 설계로 설계로 해결한 것이 아니라, 그 문제를 작게 나눠서 계층화 하려는 노력이 시도되었고 그 결과로 탄생한 것이 'TCP/IP 프로토콜 스택' 
인 것이다. 따라서 우리가 TCP 소켓을 생성해서 데이터를 송수신할 경우에는 다음 네 계층의 도움을 통해서 데이터를 송수신하게 된다.

그리고 각각의 계층을 담당하는 것은 운영체제와 같은 소프트웨어기도 하고, NIC와 같은 물리적인 장치이기도 하다.

## 참조하자! OSI 7 Layer
데이터 통신에 사용되는 프로토콜 스택은 7계층으로 세분화된다. 그러나 앞서 보인 그림에서와 같이 4계층으로 구분짓기도 한다. 만약에 프로토콜 스택 7계층을 세부적으로 이해하기 원한다면 데이터 통신에 관련된 서적을 참조하자

<br/>

## TCP/IP 프로토콜의 탄생배경
'인터넷을 통한 효율적인 데이터의 송수신' 이라는 과제의 해결을 위해 많은 전문가들이 모였다. 이들은 하드웨어 전문가부터 시작해서 시스템 전문자 , 라우팅 알고리즘 전문가 등 아주 다양한 분야의 최고 전문가들이다. 지금까지 우리는 소켓의 생성 및 활용에만 관심을 둬서 생각하지 못했지만, 네트워크는 소프트웨어만 가지고 해결할 수 있는 문제가 아니다. 소프트웨어가 존재하기 전에 하드웨어적인 시스템이 구축되어 있어야 하고, 그러한 물리적 환경을 기반으로 각종 소프트웨어적인 알고리즘이 필요로 한다. 즉, '인터넷을 통한 효율적인 데이터의 송수신' 이라는 이슈의 해결을 위해서는 아주 많은 분야의 전문가가 필요하며, 이들간의 상호 논의로 만들어진 다양한 약속이 또한 필요하다. 따라서 이 문제는 작은 문제로 나눠서 해결하는 것이 효율적이다.

결국에는 문제를 영역별로 나눠서 '인터넷을 통한 효율적인 데이터의 송수신' 에 대한 결론을 얻게 되었다. 문제를 영역별로 나눠서 해결하다 보니 프로토콜이 여러개 만들어졌으며, 이들은 계층구조를 토앻서 상호간에 관계를 맺게 되었다.

## Link 계층
그럼 이제 TCP/IP 프로토콜 스택을 계층별로 하나씩 살펴보자. 먼저 Link 계층에 대해서 설명해보자

Link 계츠층은 물리적인 영역의 표준화에 대한 결과이다. 이는 가장 기본이 되는 영역으로 LAN , WAN ,MAN 과 같은 네트워크 표준과 관련된 프로토콜을 정의하는 영역이다. 두 호스트가 인터넷을 통해 데이터를 주고받으려면 다음과 같이 물리적인 연결이 존재해야한다. 바로 이 부분에 대한 표준을 link 계층에서 담당한다.

![alt text](https://cdn.slidesharecdn.com/ss_thumbnails/week1-181013065255-thumbnail.jpg?width=640&height=640&fit=bounds)

## IP 계층
이제 물리적인 연결이 형성되었으니 데이터를 보낼 기본 준비가 되었다. 그런데 복잡하게 연결되어있는 인터넷을 통한 데이터의 전송을 위해 선행되어야 할 일은 경로의 선택이다. 목적지로 데이터를 전송하기 위해서 중간에 어떤 경로를 거쳐갈 것인가? 이 문제를 해결하는 것이 IP 계층이고, 이 계층에서 사용하는 프로토콜이 IP(Internet Protocol) 이다.

IP 자체는 비 연결지향적이며 신뢰할 수 없는 프로토콜이다. 데이터를 전송할 때마다 거쳐야 할 경로를 선택해 주지만, 그 경로는 일정치 않다. 특히 데이터 전송 도중에 경로상에 문제가 발생하면 다른 경로를 선택해 주는데, 이 과정에서 데이터가 손실되거나 오류가 발생하는 등의 문제가 발생한다고 해서 이를 해결해주지 않는다. 즉, 오류발생에 대한 대비가 되어있지 않는 프로토콜이 IP 이다.

## TCP/UDP 계층
데이터의 전송을 위한 경로의 검색은 IP 계층에서 해결해주니, 그 경로를 기준으로 데이터를 전송만하면 된다. TCP 와 UDP 계층은 이렇듯 IP 계층에서 알려준 경로정보를 바타응로 데이터의 실제 송수신을 담당한다. 때문에 이 계층을 가리켜 '전송 (Transport) 계층' 이라 한다. 전송 계층에 존재하는 UDP 는 TCP 에 비해 상대적으로 간단하며 이후에 별도로 언급 예정이다.

TCP 는 신뢰성있는 데이터의 전송을 담당한다. 그런데 TCP 가 데이터를 보낼 때 기반이 되는 프로토콜이 IP 이다. (이것이 프로토콜이 스택의 구조로 계층화 되어 있는 이유이다.) 그럼 이 둘의 관계를 이해해보자

IP 는 오로지 하나의 데이터 패킷 (데이터 전송의 기본단위)이 전송되는 과정에만 중심을 두고 설계되었다. 따라서 여러 개의 데이터 패킷을 전송한다 하더라도 각각의 패킷이 전송되는 과정은 IP 에 의해서 진행되므로 전송의 순서는 물론이거니와 전송 그 자체를 신뢰할 수 없다. 만약에 IP 만을 이용해서 데이터를 전송한다면 먼저 전송한 A 패킷보다 뒤에 전송한 B 패킷이 먼저 도달할 수도 있다. 그리고 이어서 전송한 A , B , C 패킷 중에서 A 와 C 패킷만 정송될 수 있으며 그나마 C 패킷은 손상된 상태로 전송될 수도 있다. 반면에 TCP 프로토콜이 추가되어 데이터를 송수신하면 다음과 같은 대화를 주고받게 된다.

```
호스트 A : 두번째 패킷까지 잘 받았소!
호스트 B : 네 알겠습니다.

호스트 A : 세번째 패킷까지 잘 받았소!
호스트 B : 네 번째 패킷까지 보냈는데요? 네 번째 패킷은 못받았나 보네요! 그럼 재전송 하겠습니다.
```

이것이 바로 TCP 의 역할 이다. 이렇듯 데이터를 주고받는 과정에서 서로 데이터의 주고 받음을 확인한다면, 그리고 분실된 데이터에 대해서 재전송해준다면, 데이터의 전송을 신뢰할 수 있지 않겠는가 비록 IP 가 데이터의 전송을 보장하지 않더라도 말이다.

결론적으로 IP 의 상위계층에서 호스트 대 호스트의 데이터 송수신 방식을 약속하는 것이 TCP 그리고 UDP 이며, TCP 는 확인 절차를 걸쳐서 신뢰성 없는 IP 에 신뢰성을 보여한 프로토콜이라 할 수 있다.

## APPLICATION 계층
지금까지 설명한 내용은 소켓을 생성하면 데이터 송수신 과정에서 자동으로 처리되는 것들이다. 데이터의 전송경로를 확인하는 과정이라든가 데이터 수신에 대한 응답과정이 소켓이라는 것 하나에 감춰져 있기 때문이다. 그러나 감춰져 있다는 표현보다는 이러한 일들에 대해서 프로그래머를 자유롭게 해줬다는 표현이 더 정확하다. 즉, 프로그래밍에 있어서 이러한 과정을 우리가 신경 쓰지 않아도 된다는 뜻이다.

하지만 신경을 쓰지 않아도 될 뿐이지 몰라도 된다는 것은 아니다. 이러한 이론적인 내용들도 알고 있어야 필요에 맞는 네트워크 프로그램을 작성할 수 있다. 최종적으로 소켓이라는 도구가 우리에게 주어졌고 우리는 이 도구를 이용해서 무엇인가를 만들면 된다.

이렇게 무엇인가를 만드는 과정에서 프로그램의 성격에 따라 클라이언트와 서버가느이 데이터 송수신에 대한 약속(규칙)들이 정해지기 마련인데 , 이를 가리켜 APPLICATION 프로토콜이라 한다. 그리고 대부분의 네트워크 프로그래밍은 APPLICATION 프로토콜의 설계 및 구현이 상당부분을 차지한다.


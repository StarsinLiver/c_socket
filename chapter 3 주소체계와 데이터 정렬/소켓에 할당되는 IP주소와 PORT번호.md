# 소켓에 할당되는 IP 주소와 PORT 번호
IP 는 Integernet Protocol 의 약자로 인터넷상에서 데이터를 송수신할 목적으로 컴퓨터에게 부여하는 값을 의미한다. 반면 PORT 번호는 컴퓨터에게 부여하는 값이 아닌,  프로그램상에서 생성되는 소켓을 구분하기 위해 소켓에 부여되는 번호를 뜻한다.

## 인터넷 주소
인터넷에 컴퓨터를 연결해서 데이터를 주고받기 위해서는 IP 주소를 부여받아야 한다. 이러한 IP 주소체계는 다음과 같이 두 종류로 나뉜다.

```
IPv4 (Internet Protocol version 4) : 4 바이트 주소체계
IPv6 (Internet Protocol version 6) : 16 바이트 주소체계
```

IPv4 와 IPv6 의 차이점은 IP 주소의 표현에 사용되는 바이트 크기에 있다. 오늘날 우리가 범용적으로 사용하는 주소체계는 IPv4 이다. IPv6는 2010년을 전후로 IP주소가 모두 고갈될 것을 염려하여 만든 표준인데, 그럼에도 불구하고 아직도 IPv4가 주로 사용되고 있다. 

IPv4 기준의 4바이트 IP 주소는 네트워크 주소와 호스트(컴퓨터를 의미) 주소로 나뉘며, 주소의 형태에 따라서 A,B,C,D,E 클래스로 분류가 된다. 

![alt text](/image/image.png);

네트워크 주소(네트워크 ID)란 네트워크의 구분을 위한 IP 주소의 일부를 말한다. 예를 들어서 WWW.SEMI.COM 이라는 회사의 무대리에게 데이터를 전송한다고 가정해보자. 그런데 이 회사의 컴퓨터는 하나의 로컬 네트워크로 연결되어있다. 즉, 처음부터 4바이트 IP 주소 전부를 참조해서 무대리의 컴퓨터로 데이터가 전송되는것이 아니라, 4바이트 IP 주소 중에서 네트워크 주소만을 참조해서 일단 SEMI.COM 의 네트워크로 데이터가 전송된다. 그리고 SEMI.COM 의 네트워크로 데이터가 전송되었다면 해당 네트워크를 구성하는 라우터는 전송된 데이터의 호스트 주소 (호스트 ID)를 참조하여 무대리의 컴퓨터로 데이터를 전소앻준다.

![alt text](/image/image2.png)

위 그림에서 알수 있듯이 임의의 호스트가 203.211.172.103과 203.211.217.202 로 데이터를 전송한다면 그 중에서 203.211.172 와 203.211.217 은 네트워크 주소이다. 따라서 해당 네트워크로 데이터가 전송된다. 단, 네트워크로 데이터가 전송된다는 것은 네트워크를 구성하는 라우터 (Router) 또는 스위치 (Switch) 로 데이터가 전송됨을 ㄸ스한다. 그러면 데이터를 전송받은 라우터는 데이터에 적혀있는 호스트 주소를 참조하여 호스트에 데이터를 전송해준다.

라우터와 스위치도 단순히 컴퓨터이고 다만 특별한 기능을 하는 컴퓨터라서 그런 이름으로 불리는 것이다. 우리가 사용하는 컴퓨터도 적절한 소프트웨어만 설치 및 구성하면 라우터로 동작시킬 수 있다. 그리고 라우터보다 기능적으로 작은 것을 가리켜 스위치라 부르는데, 사실상 이 둘은 같은 의미로 사용이 된다.

## 클래스 별 네트워크 주소와 호스트 주소의 경계
IP 주소의 첫 번째 바이트만 딱 보면 네트워크 주소가 몇 바이트인지 판단이 가능하다. 왜냐하면 다음과 같이 클래스 별 IP 주소의 경계를 나눠놓았기 때문이다.

|범위|숫자|
|:--:|:--:|
|클래스 A의 첫 번째 바이트 범위|0 이상 127 이하|
|클래스 B의 첫 번째 바이트 범위|128 이상 191 이하|
|클래스 C의 첫 번째 바이트 범위|192 이상 223 이하|

이는 다음과 같이 달리 표현할 수 있다.

1. 클래스 A 의 첫번째 비트는 항상 0으로 시작
2. 클래스 B 의 첫 두번째 비트는 항상 10으로 시작
3. 클래스 C의 첫 세 비트는 항상 110으로 시작

## 소켓의 구분에 활용되는 PORT의 번호
IP 는 컴퓨터를 구분하기위한 목적으로 존재한다. 때문에 IP 만 있다면 목적지 컴퓨터로 데이터를 전송할 순있다. 그러나 이것만 가지고 데이터를 수신해야 하는 최종목적지인 응용프로그램에까지 데이터를 전송할 순 없다. 예를 들어서 현재 우리가 동영상을 시청하면서 인터넷 서핑을 함께하고 있다면 동영상 데이터의 수신을 위한 소켓 하나와 인터넷 정보의 수신을 위한 소켓 하나가 최소한으로 필요하다. 그런데 이 둘을 어떻게 구분할 수 있을까?

쉽게 말해서 우리의 컴퓨터로 전송되어오는 데이터를 동영상을 실행하는 플레이어에게 전달해주겠는가? 아니면 웹 검색도구인 브라우저에게 전달해주겠는가? 다음을 보자

"나는 데이터를 주고받는 P2P 프로그램을 개발했어. 이 프로그램은 하나의 파일을 블록단위로 나눠서 동시에 둘 이상의 컴퓨터로부터 데이터를 전송 받지!"

위 문장에서 말하듯이 둘 이상의 컴퓨터로부터 데이터를 전송받으려면 둘 이상의 소켓이 생성되어야 하지 않겠는가? 그렇다면 이들 소켓은 어떻게 구분하겠는가. 우리의 컴퓨터에는 NIC(네트워크 인터페이스 카드)라 불리는 데이터 송수신장치가 하나씩 달려있다. IP는 데이터를 NIC를 통해 컴퓨터 내부로 전송하는데 사용된다. 그러나 컴퓨터 내부로 전송된 데이터를 소켓에 적절히 분배하는 작업은 운영체제가 담당한다. 이 때 운영체제는 PORT 번호를 활용한다. 즉 NIC를 통해서 수신된 데이터 안에는 PORT 번호가 새겨져 있다. 운영체제는 바로 이 정보를 참조해서 일치하는 PORT 번호의 소켓에 데이터를 전달하는 것이다.

이렇듯 PORT 번호는 하나의 운영체제 내에서 소켓을 구분하는 목적으로 사용되기 때문에 하나의 운영체제 내에서 동일한 PORT 번호를 둘 이상의 소켓에 할당할 수 없다. 그리고 PORT 번호는 16비트로 표현된다. 때문에 할당할 수 있는 PORT 번호의 범위는 0 이상 65535 이하이다. 그러나 0 번 부터 1023 번까지는 "잘 알려진 PORT (Well-known PORT)" 라고 해서 특정 프로그램에 할당하기로 예약되었기 때문에 이 범위의 값을 제외한 다른 값을 할당해야 한다. 그리고 PORT 번호는 중복이 불가능하지만 TCP 소켓과 UDP 소켓은 PORT 번호를 공유하지 않기 때문에 중복되어도 상관없다. 즉 TCP 소켓을 생성할 때 9190 PORT를 할당했다면 다른 TCP 소켓에는 9190 PORT를 할당하지 못하지만, UDP 소켓에는 할당할 수 있다.

정리하면 우리가 흔히 말하는 데이터 전송의 목적지 주소에는 IP 주소 뿐만아니라 PORT 번호도 포함이된다. 그래야 최종 목적지에 해당하는 응용프로그램에까지 (응용 프로그램 소켓까지) 데이터를 전달할 수 있기 때문이다.




